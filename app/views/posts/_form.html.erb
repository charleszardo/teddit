<% action = post.persisted? ? post_url(post) : sub_posts_url %>
<% method = post.persisted? ? :patch : :post %>

<form action="<%= action %>" method="post">
<%= auth_token %>
<input type="hidden" name="_method" value="<%= method %>">
<label for="post_url">URL</label>
<input type="text" name="post[url]" value="<%= post.url %>" id="post_url">
<br>
<h4>Sub(s)</h4>
<input type="hidden" name="post[sub_ids][]" value="">
<% Sub.all.each do |sub| %>
  <label>
    <input type="checkbox"
           name="post[sub_ids][]"
           value="<%= sub.id %>"
           <%= "checked" if post.sub_ids.include?(sub.id) %>>
    <%= sub.title %>
  </label>
  <br>
<% end %>
<br>
<input type="submit" value="submit">
</form>
